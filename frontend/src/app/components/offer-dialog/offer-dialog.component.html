<h2 mat-dialog-title>Create offer</h2>

<mat-dialog-content>
  <form [formGroup]="offerForm" style="display: flex; flex-direction: column; gap: 15px; padding-top: 10px;">

    <mat-form-field appearance="outline">
      <mat-label>Search Product</mat-label>
      <input type="text"
             placeholder="Type at least 2 characters..."
             matInput
             [formControl]="productSearchControl"
             [matAutocomplete]="auto">
      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onProductSelected($event)">
        <mat-option *ngFor="let p of filteredProducts" [value]="p.id">
          {{ p.name }} ({{ p.unitPrice | currency:'EUR' }})
        </mat-option>
      </mat-autocomplete>
      <input type="hidden" formControlName="productId">
      <mat-error *ngIf="offerForm.get('productId')?.hasError('required')">Please select a product from the list</mat-error>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Unit (Quantity)</mat-label>
      <input matInput type="number" formControlName="requiredQuantity">
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Total Offer Price</mat-label>
      <input matInput type="number" formControlName="offerPrice">
      <span matTextPrefix>â‚¬&nbsp;</span>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Expiry Date (Optional)</mat-label>
      <input matInput type="datetime-local" formControlName="expiryDate">
      <mat-hint>If left empty, defaults to 1 week</mat-hint>
    </mat-form-field>

  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="dialogRef.close()">Cancel</button>
  <button mat-flat-button color="primary" (click)="onSubmit()" [disabled]="offerForm.invalid">Save</button>
</mat-dialog-actions>

<mat-divider style="margin: 20px 0;"></mat-divider>

<div class="offers-section">
  <h3>Active Offers</h3>

  <mat-list role="list">
    <mat-list-item *ngFor="let off of existingOffers" role="listitem">
      <mat-icon matListItemIcon color="accent">local_offer</mat-icon>
      <div matListItemTitle><strong>{{ off.product.name }}</strong></div>
      <div matListItemLine>
        Buy {{ off.requiredQuantity }} units for {{ off.offerPrice | currency:'EUR' }}
      </div>
      <div matListItemLine style="font-size: 0.85em; color: #757575;">
        <mat-icon style="font-size: 14px; height: 14px; width: 14px; vertical-align: middle; margin-right: 4px;">timer</mat-icon>
        <span>Valid until: {{ off.expiryDate | date:'medium' }}</span>
      </div>

      <button
        *ngIf="off.id !== undefined"
        mat-icon-button
        matListItemMeta
        (click)="onDeleteOffer(off.id)"
        title="Delete Offer"
      >
        <mat-icon color="warn">delete</mat-icon>
      </button>
    </mat-list-item>
  </mat-list>

  <div *ngIf="existingOffers.length === 0" style="text-align: center; color: #999; padding: 10px;">
    There is no active offer.
  </div>
</div>
